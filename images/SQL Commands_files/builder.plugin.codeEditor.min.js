/*!
 * Copyright (c) 2013, 2024, Oracle and/or its affiliates.
 */
!function(e,t,i,a,r,n,o){"use strict";e.codeEditor=function(e,d){let s,u,l,c,g,f,p,h,m,E,x=a(e),v=x.children("textarea")[0],O=a(v),I=O.is("[lazy-load]");function b(e){var t=e.toLowerCase();return t.indexOf("plsql")>-1?"plsql":t}if(v&&v.id&&(s=v.id),s&&(u=t.create(s,{delayLoading:!I,setValue:function(e){let t=e;d.diffEditor&&(t=JSON.parse(t)),x.codeEditor("setValue",t)},getValue:function(){const e=x.codeEditor("getValue");return d.diffEditor?JSON.stringify(e):e},getEditor:function(){return x.codeEditor("getEditor")},getEditor$:function(){return x},setFocusTo:function(){return x.codeEditor("focus"),{focus:function(){}}},isChanged:function(){return this.node.defaultValue!==this.getValue()}})),d.language)p=d.language;else{if(!d.modeBasedOnItem)throw new Error("Either a language mode or a Page Item which holds the language must be provided");p=b($v(d.modeBasedOnItem)),a("#"+r.escapeCSS(d.modeBasedOnItem)).on("change",(function(){x.codeEditor("option","language",b($v(d.modeBasedOnItem)))}))}if(x.height(18*(v.rows||5)+50),O.hide(),d.validate&&!d.readOnly&&(l=function(e,t){let a=e;d.diffEditor&&(a=a.modified),i.plugin(d.ajaxIdentifier,{x01:"validate",x02:d.appId,x09:""===d.itemRemoteDB?null:$v(d.itemRemoteDB),x10:d.modeBasedOnItem?$v(d.modeBasedOnItem):null,p_clob_01:a},{success:function(e){"OK"===e.result?t({errors:[]}):t({errors:[e.result]})}})}),d.queryBuilder&&(c=function(e){d.itemRemoteDB&&""!==d.itemRemoteDB?apex.message.alert(o.formatMessage("WWV_FLOW_BUILDER.REMOTESQL.QUERY_BUILDER_NOT_SUPPORTED")):apex.navigation.popup({url:apex.util.makeApplicationUrl({appId:4500,pageId:1002,clearCache:1002,itemNames:["P1002_RETURN_INTO","P1002_POPUP","P1002_SCHEMA"],itemValues:[e.baseId,"1",d.parsingSchema]}),width:950,height:720})}),g=function(e,t){""===$v(d.itemRemoteDB)?i.plugin(d.ajaxIdentifier,{p_widget_name:e.type,x01:"hint",x02:d.appId,x03:e.search,x04:e.parent,x05:e.grantParent},{success:t}):n.info(o.formatMessage("WWV_FLOW_BUILDER.REMOTESQL.CODE_COMPLETION_NOT_SUPPORTED"))},f=function(){var e=a(this).codeEditor("getPreferencesString");i.plugin(d.ajaxIdentifier,{x01:"save",x02:d.appId,x03:e},{queue:{name:"codeEditor_save_settings",action:"lazyWrite"},dataType:""})},d.diffEditor){try{m=JSON.parse(v?a(v).val():'{"original":"","modified":""}')}catch(e){throw new Error("A diff code editor's value must be a stringified JSON")}if("string"!=typeof m.original||"string"!=typeof m.modified)throw new Error("A diff code editor's value must contain 2 String values with keys 'original' and 'modified'")}else m=v?a(v).val():"";d.aiEnabled&&(E={ajax:{ajaxId:d.ajaxIdentifier}}),h=a.extend({language:p,value:m,readOnly:d.readOnly,ariaLabel:d.ariaLabel,codeComplete:g,validateCode:l,queryBuilder:(!d.itemRemoteDB||""===d.itemRemoteDB)&&c,preferencesChanged:f,diffEditor:d.diffEditor,ai:E},a.apex.codeEditor.preferencesObjectFromString(d.settings||"")),d.initJavascriptCode&&(h=d.initJavascriptCode(h));var y=h.onInitialized;h.onInitialized=function(e){y&&y(e),s&&!I&&u.resolve()},h.lazyLoad=I,x.codeEditor(h),d.adjustableHeight&&(x.wrap("<div class='a-CodeEditor--resizeWrapper'></div>").parent().resizable({handles:"s",helper:"a-CodeEditor--resizeHelper",minHeight:100,maxHeight:1e3}).on("resizestop",(function(){var e=a(this),t=a(this).children().eq(0);t.height(e.height()),t.trigger("resize")})),x.parent().find(".ui-resizable-handle.ui-resizable-s").attr("tabindex",0).on("keydown",(function(e){if(e.which===a.ui.keyCode.UP||e.which===a.ui.keyCode.DOWN){var t,i=a(this).parent();t=e.which===a.ui.keyCode.UP?i.height()-10:i.height()+10,t=Math.max(t,100),t=Math.min(t,1e3),i.height(t).trigger("resizestop"),e.preventDefault()}}))),apex.widget.util.onVisibilityChange(x[0],(function(e){e&&x.trigger("resize")}))},e.codeEditor.saveProcess=function(e,t,r,n){var o,d=n?a.extend(!0,{},n):{};if((o=a(e).codeEditor("getValue")).length<=4e3)d[r]=o;else{for(d[r]=[];o.length>4e3;)d[r].push(o.substr(0,4e3)),o=o.substr(4e3);d[r].push(o.substr(0,4e3))}return i.process(t,d,{dataType:"",loadingIndicator:e,loadingIndicatorPosition:"page"})},e.codeEditor.saveSubmit=function(e,t,i){var n,o=i.form||"wwv_flow",d=a("form[name='"+r.escapeHTMLAttr(o)+"']",apex.gPageContext$);function s(e){d.append("<input type='hidden' name='"+r.escapeHTMLAttr(t)+"' value = '"+apex.util.escapeHTML(e)+"'>")}if((n=a(e).codeEditor("getValue")).length<=4e3)s(n);else{for(;n.length>4e3;)s(n.substr(0,4e3)),n=n.substr(4e3);s(n.substr(0,4e3))}apex.page.submit(i)},a((function(){a(document.body).on("codeeditorpreferenceschanged",(function(e){var t=a(e.target),i=a.apex.codeEditor.preferencesObjectFromString(t.codeEditor("getPreferencesString"));a(".a-MonacoEditor").each((function(){this!==e.target&&a(this).codeEditor("option",i)}))}))}))}(apex.builder.plugin,apex.item,apex.server,apex.jQuery,apex.util,apex.debug,apex.lang);